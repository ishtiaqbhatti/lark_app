import{ai as u,aj as e,al as p,ag as I,af as F,av as N,r as w,ah as g,aA as M,aB as C,aC as j,ak as T,aI as k,Z as y,am as f,an as m,aM as L,as as E,aN as q,aO as D}from"./index-igZMX4Bp.js";import{u as B}from"./useMutation-Bs8GWcgR.js";import{u as O}from"./useClient-BASY--XD.js";import{M as P}from"./index-Bm9ETF0h.js";import{S as h}from"./index-RK4UnpeA.js";const Q=({open:a,onCancel:d,onAddClient:n,loading:t})=>{const[r]=u.useForm(),l=()=>{r.validateFields().then(s=>{n(s),r.resetFields()}).catch(s=>{console.log("Validate Failed:",s)})};return e.jsx(P,{title:"Add New Client",open:a,onOk:l,onCancel:d,confirmLoading:t,okText:"Add Client",children:e.jsxs(u,{form:r,layout:"vertical",name:"add_client_form",children:[e.jsx(u.Item,{name:"client_name",label:"Client Name",rules:[{required:!0,message:"Please enter the client's name!"}],children:e.jsx(p,{autoFocus:!0})}),e.jsx(u.Item,{name:"client_id",label:"Client ID",rules:[{required:!0,message:"Please enter a unique client ID!"}],extra:"This should be a unique identifier for the client (e.g., my_company_name).",children:e.jsx(p,{})})]})})},{Content:V}=j,{Title:_}=T,R=({client:a,onSelectClient:d,isActive:n})=>{var s,o,c;const{data:t,isLoading:r,isError:l}=g(["dashboardStats",a.client_id],()=>L(a.client_id),{enabled:!!a.client_id,staleTime:3e5,cacheTime:6e5});return e.jsxs(E,{title:e.jsx(_,{level:5,style:{margin:0},children:a.client_name}),extra:e.jsx(y,{type:n?"primary":"default",onClick:()=>d(a.client_id),disabled:n,children:n?"Current Client":"Select"}),style:{marginBottom:"16px"},loading:r,children:[e.jsxs(f,{gutter:16,children:[e.jsx(m,{span:8,children:e.jsx(h,{title:"Opportunities",value:((s=t==null?void 0:t.status_counts)==null?void 0:s.all)||0})}),e.jsx(m,{span:8,children:e.jsx(h,{title:"Qualified",value:((o=t==null?void 0:t.status_counts)==null?void 0:o.validated)||0})}),e.jsx(m,{span:8,children:e.jsx(h,{title:"Generated",value:((c=t==null?void 0:t.status_counts)==null?void 0:c.generated)||0})})]}),l&&e.jsx(C,{message:"Error loading stats",description:(l==null?void 0:l.message)||"Failed to load dashboard statistics.",type:"error",style:{marginTop:"16px"}})]})},K=()=>{const{clientId:a,setClientId:d}=O(),{showNotification:n}=I(),t=F(),r=N(),[l,s]=w.useState(!1),{data:o=[],isLoading:c,isError:b,error:x}=g("clients",D),{mutate:v,isLoading:S}=B(i=>q(i),{onSuccess:()=>{n("success","Client Added","New client has been successfully added."),t.invalidateQueries("clients"),s(!1)},onError:i=>{n("error","Failed to Add Client",i.message||"An error occurred while adding the client.")}}),A=i=>{d(i),r("/dashboard")};return c?e.jsx(M,{tip:"Loading clients...",style:{display:"block",marginTop:"50px"}}):b?e.jsx(C,{message:"Error",description:(x==null?void 0:x.message)||"Failed to load clients. Please try again.",type:"error",showIcon:!0}):e.jsxs(j,{style:{padding:"24px"},children:[e.jsxs(V,{children:[e.jsx(_,{level:2,children:"Client Dashboard"}),e.jsx(k,{style:{marginBottom:"16px"},children:e.jsx(y,{type:"primary",onClick:()=>s(!0),children:"Add New Client"})}),e.jsx(f,{gutter:[16,16],children:o.map(i=>e.jsx(m,{xs:24,sm:12,md:8,lg:6,children:e.jsx(R,{client:i,onSelectClient:A,isActive:i.client_id===a})},i.client_id))})]}),e.jsx(Q,{open:l,onCancel:()=>s(!1),onAddClient:v,loading:S})]})};export{K as default};
